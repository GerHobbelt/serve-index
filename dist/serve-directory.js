/*!
 * serve-index
 * Copyright(c) 2011 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 */
/*!
 *
 * serve-directory
 * Copyright(c) 2017- fisker Cheung
 * MIT Licensed
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require("./utils.js"),_utils2=_interopRequireDefault(_utils),_connection=require("./connection.js"),_connection2=_interopRequireDefault(_connection),_defaultOptions=require("./default-options.js"),_defaultOptions2=_interopRequireDefault(_defaultOptions);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function responser(a,b){return function(c,d,e){var f=b(e);d.setHeader("X-Content-Type-Options","nosniff"),d.setHeader("Content-Type",a+"; charset="+_utils2.default.CHARSET),d.setHeader("Content-Length",Buffer.byteLength(f,_utils2.default.CHARSET)),d.end(f,_utils2.default.CHARSET)}}var ServeDirectory=function(){function a(b,c){_classCallCheck(this,a);try{b=_utils2.default.path.normalize(_utils2.default.path.resolve(b)+_utils2.default.path.sep),_utils2.default.fs.statSync(b)}catch(a){throw a}this.root=b,this.responser={},this.options={hidden:_defaultOptions2.default.hidden,relative:_defaultOptions2.default.relative},this.imports=Object.assign({},_utils2.default),this.config(_defaultOptions2.default),c&&this.config(c)}return _createClass(a,[{key:"config",value:function(a){var b=this;(!0===a.hidden||!1===a.hidden)&&(b.options.hidden=a.hidden),(!0===a.relative||!1===a.relative)&&(b.options.relative=a.relative),a.imports&&Object.assign(b.imports,a.imports),a.process&&a.process.filter(Boolean).forEach(function(a){a.accept.split(",").map(_utils2.default.trim).filter(Boolean).forEach(function(c){a.render?b.responser[c]=responser(c,_utils2.default.template(a.render,{imports:b.imports})):delete b.responser[c]})})}},{key:"middleware",value:function(a,b,c){try{return new _connection2.default(this,a,b,c).response()}catch(a){c(a)}}}]),a}();exports.default=ServeDirectory,module.exports=exports["default"];